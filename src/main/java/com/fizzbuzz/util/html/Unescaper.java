package com.fizzbuzz.util.html;

import com.google.common.collect.ImmutableMap;

// see http://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Character_entity_references_in_HTML

public class Unescaper {
    private static ImmutableMap<String, String> map = new ImmutableMap.Builder<String, String>()
            .put("&quot", "\"")
            .put("&#34", "\"")
            .put("&amp", "&")
            .put("&#38", "&")
            .put("&apos", "'")
            .put("&#39", "'")
            .put("&lt", "<")
            .put("&#60", "<")
            .put("&gt", ">")
            .put("&#62", ">")
            .put("&nbsp", " ")
            .put("&#160", " ")
            .put("&iexcl", "¡")
            .put("&#161", "¡")
            .put("&cent", "¢")
            .put("&#162", "¢")
            .put("&pound", "£")
            .put("&#163", "£")
            .put("&curren", "¤")
            .put("&#164", "¤")
            .put("&yen", "¥")
            .put("&#165", "¥")
            .put("&brvbar", "¦")
            .put("&#166", "¦")
            .put("&sect", "§")
            .put("&#167", "§")
            .put("&uml", "¨")
            .put("&#168", "¨")
            .put("&copy", "©")
            .put("&#169", "©")
            .put("&ordf", "ª")
            .put("&#170", "ª")
            .put("&laquo", "«")
            .put("&#171", "«")
            .put("&not", "¬")
            .put("&#172", "¬")
            .put("&shy", "")
            .put("&#173", "")
            .put("&reg", "®")
            .put("&#174", "®")
            .put("&macr", "¯")
            .put("&#175", "¯")
            .put("&deg", "°")
            .put("&176", "°")
            .put("&plusmn", "±")
            .put("&#177", "±")
            .put("&sup2", "²")
            .put("&#178", "²")
            .put("&sup3", "³")
            .put("&#179", "³")
            .put("&acute", "´")
            .put("&#180", "´")
            .put("&micro", "µ")
            .put("&#181", "µ")
            .put("&para", "¶")
            .put("&#182", "¶")
            .put("&middot", "·")
            .put("&#183", "·")
            .put("&cedil", "¸")
            .put("&#184", "¸")
            .put("&sup1", "¹")
            .put("&#185", "¹")
            .put("&ordm", "º")
            .put("&#186", "º")
            .put("&raquo", "»")
            .put("&#187", "»")
            .put("&frac14", "¼")
            .put("&#188", "¼")
            .put("&frac12", "½")
            .put("&#189", "½")
            .put("&frac34", "¾")
            .put("&#190", "¾")
            .put("&iquest", "¿")
            .put("&#191", "¿")
            .put("&Agrave", "À")
            .put("&#192", "À")
            .put("&Aacute", "Á")
            .put("&#193", "Á")
            .put("&Acirc", "Â")
            .put("&#194", "Â")
            .put("&Atilde", "Ã")
            .put("&#195", "Ã")
            .put("&Auml", "Ä")
            .put("&#196", "Ä")
            .put("&Aring", "Å")
            .put("&#197", "Å")
            .put("&AElig", "Æ")
            .put("&#198", "Æ")
            .put("&Ccedil", "Ç")
            .put("&#199", "Ç")
            .put("&Egrave", "È")
            .put("&#200", "È")
            .put("&Eacute", "É")
            .put("&#201", "É")
            .put("&Ecirc", "Ê")
            .put("&#202", "Ê")
            .put("&Euml", "Ë")
            .put("&#203", "Ë")
            .put("&Igrave", "Ì")
            .put("&#204", "Ì")
            .put("&Iacute", "Í")
            .put("&#205", "Í")
            .put("&Icirc", "Î")
            .put("&#206", "Î")
            .put("&Iuml", "Ï")
            .put("&#207", "Ï")
            .put("&ETH", "Ð")
            .put("&#208", "Ð")
            .put("&Ntilde", "Ñ")
            .put("&#209", "Ñ")
            .put("&Ograve", "Ò")
            .put("&#210", "Ò")
            .put("&Oacute", "Ó")
            .put("&#211", "Ó")
            .put("&Ocirc", "Ô")
            .put("&#212", "Ô")
            .put("&Otilde", "Õ")
            .put("&#213", "Õ")
            .put("&Ouml", "Ö")
            .put("&#214", "Ö")
            .put("&times", "×")
            .put("&#215", "×")
            .put("&Oslash", "Ø")
            .put("&#216", "Ø")
            .put("&Ugrave", "Ù")
            .put("&#217", "Ù")
            .put("&Uacute", "Ú")
            .put("&#218", "Ú")
            .put("&Ucirc", "Û")
            .put("&#219", "Û")
            .put("&Uuml", "Ü")
            .put("&#220", "Ü")
            .put("&Yacute", "Ý")
            .put("&#221", "Ý")
            .put("&THORN", "Þ")
            .put("&#222", "Þ")
            .put("&szlig", "ß")
            .put("&#223", "ß")
            .put("&agrave", "à")
            .put("&#224", "à")
            .put("&aacute", "á")
            .put("&#225", "á")
            .put("&acirc", "â")
            .put("&#226", "â")
            .put("&atilde", "ã")
            .put("&#227", "ã")
            .put("&auml", "ä")
            .put("&#228", "ä")
            .put("&aring", "å")
            .put("&#229", "å")
            .put("&aelig", "æ")
            .put("&#230", "æ")
            .put("&ccedil", "ç")
            .put("&#231", "ç")
            .put("&egrave", "è")
            .put("&#232", "è")
            .put("&eacute", "é")
            .put("&#233", "é")
            .put("&ecirc", "ê")
            .put("&234", "ê")
            .put("&euml", "ë")
            .put("&#235", "ë")
            .put("&igrave", "ì")
            .put("&#236", "ì")
            .put("&iacute", "í")
            .put("&#237", "í")
            .put("&icirc", "î")
            .put("&#238", "î")
            .put("&iuml", "ï")
            .put("&#239", "ï")
            .put("&eth", "ð")
            .put("&#240", "ð")
            .put("&ntilde", "ñ")
            .put("&#241", "ñ")
            .put("&ograve", "ò")
            .put("&#242", "ò")
            .put("&oacute", "ó")
            .put("&243", "ó")
            .put("&ocirc", "ô")
            .put("&#244", "ô")
            .put("&otilde", "õ")
            .put("&245", "õ")
            .put("&ouml", "ö")
            .put("&246", "ö")
            .put("&divide", "÷")
            .put("&#247", "÷")
            .put("&oslash", "ø")
            .put("&248", "ø")
            .put("&ugrave", "ù")
            .put("&249", "ù")
            .put("&uacute", "ú")
            .put("&#250", "ú")
            .put("&ucirc", "û")
            .put("&#251", "û")
            .put("&uuml", "ü")
            .put("&#252", "ü")
            .put("&yacute", "ý")
            .put("&#253", "ý")
            .put("&thorn", "þ")
            .put("&#254", "þ")
            .put("&yuml", "ÿ")
            .put("&#255", "ÿ")
            .put("&OElig", "Œ")
            .put("&#338", "Œ")
            .put("&oelig", "œ")
            .put("&#339", "œ")
            .put("&Scaron", "Š")
            .put("&352", "Š")
            .put("&scaron", "š")
            .put("&353", "š")
            .put("&Yuml", "Ÿ")
            .put("&#376", "Ÿ")
            .put("&fnof", "ƒ")
            .put("&#402", "ƒ")
            .put("&circ", "ˆ")
            .put("&#710", "ˆ")
            .put("&tilde", "˜")
            .put("&#732", "˜")
            .put("&Alpha", "Α")
            .put("&#913", "Α")
            .put("&Beta", "Β")
            .put("&#914", "Β")
            .put("&Gamma", "Γ")
            .put("&#915", "Γ")
            .put("&Delta", "Δ")
            .put("&#916", "Δ")
            .put("&Epsilon", "Ε")
            .put("&#917", "Ε")
            .put("&Zeta", "Ζ")
            .put("&#918", "Ζ")
            .put("&Eta", "Η")
            .put("&#919", "Η")
            .put("&Theta", "Θ")
            .put("&#920", "Θ")
            .put("&Iota", "Ι")
            .put("&#921", "Ι")
            .put("&Kappa", "Κ")
            .put("&#922", "Κ")
            .put("&Lambda", "Λ")
            .put("&#923", "Λ")
            .put("&Mu", "Μ")
            .put("&#924", "Μ")
            .put("&Nu", "Ν")
            .put("&#925", "Ν")
            .put("&Xi", "Ξ")
            .put("&#926", "Ξ")
            .put("&Omicron", "Ο")
            .put("&#927", "Ο")
            .put("&Pi", "Π")
            .put("&#928", "Π")
            .put("&Rho", "Ρ")
            .put("&#929", "Ρ")
            .put("&Sigma", "Σ")
            .put("&#930", "Σ")
            .put("&Tau", "Τ")
            .put("&#932", "Τ")
            .put("&Upsilon", "Υ")
            .put("&#933", "Υ")
            .put("&Phi", "Φ")
            .put("&#934", "Φ")
            .put("&Chi", "Χ")
            .put("&#935", "Χ")
            .put("&Psi", "Ψ")
            .put("&#936", "Ψ")
            .put("&Omega", "Ω")
            .put("&#937", "Ω")
            .put("&alpha", "α")
            .put("&#945", "α")
            .put("&beta", "β")
            .put("&#946", "β")
            .put("&gamma", "γ")
            .put("&#947", "γ")
            .put("&delta", "δ")
            .put("&#948", "δ")
            .put("&epsilon", "ε")
            .put("&#949", "ε")
            .put("&zeta", "ζ")
            .put("&#950", "ζ")
            .put("&eta", "η")
            .put("&#951", "η")
            .put("&theta", "θ")
            .put("&#952", "θ")
            .put("&iota", "ι")
            .put("&#953", "ι")
            .put("&kappa", "κ")
            .put("&#954", "κ")
            .put("&lambda", "λ")
            .put("&#955", "λ")
            .put("&mu", "μ")
            .put("&#956", "μ")
            .put("&nu", "ν")
            .put("&#957", "ν")
            .put("&xi", "ξ")
            .put("&#958", "ξ")
            .put("&omicron", "ο")
            .put("&#959", "ο")
            .put("&pi", "π")
            .put("&#960", "π")
            .put("&rho", "ρ")
            .put("&#961", "ρ")
            .put("&sigmaf", "ς")
            .put("&#962", "ς")
            .put("&sigma", "σ")
            .put("&#963", "σ")
            .put("&tau", "τ")
            .put("&#964", "τ")
            .put("&upsilon", "υ")
            .put("&#965", "υ")
            .put("&phi", "φ")
            .put("&#966", "φ")
            .put("&chi", "χ")
            .put("&#967", "χ")
            .put("&psi", "ψ")
            .put("&#968", "ψ")
            .put("&omega", "ω")
            .put("&#969", "ω")
            .put("&thetasym", "ϑ")
            .put("&#977", "ϑ")
            .put("&upsih", "ϒ")
            .put("&#978", "ϒ")
            .put("&piv", "ϖ")
            .put("&#982", "ϖ")
            .put("&ensp", " ")
            .put("&#8194", " ")
            .put("&emsp", " ")
            .put("&#8195", " ")
            .put("&thinsp", " ")
            .put("&#8201", " ")
            // .put("&zwnj","
            // .put("&zwj","
            // .put("&lrm","
            // .put("&rlm","
            .put("&ndash", "–")
            .put("&#8211", "–")
            .put("&mdash", "—")
            .put("&#8212", "—")
            .put("&lsquo", "‘")
            .put("&#8216", "‘")
            .put("&rsquo", "’")
            .put("&#8217", "’")
            .put("&sbquo", "‚")
            .put("&#8218", "‚")
            .put("&ldquo", "“")
            .put("&#8220", "“")
            .put("&rdquo", "”")
            .put("&#8221", "”")
            .put("&bdquo", "„")
            .put("&#8222", "„")
            .put("&dagger", "†")
            .put("&#8224", "†")
            .put("&Dagger", "‡")
            .put("&#8225", "‡")
            .put("&bull", "•")
            .put("&#8226", "•")
            .put("&hellip", "…")
            .put("&#8230", "…")
            .put("&permil", "‰")
            .put("&#8240", "‰")
            .put("&prime", "′")
            .put("&#8242", "′")
            .put("&Prime", "″")
            .put("&#8243", "″")
            .put("&lsaquo", "‹")
            .put("&#8249", "‹")
            .put("&rsaquo", "›")
            .put("&#8250", "›")
            .put("&oline", "‾")
            .put("&#8254", "‾")
            .put("&frasl", "⁄")
            .put("&#8260", "⁄")
            .put("&euro", "€")
            .put("&#8364", "€")
            .put("&image", "ℑ")
            .put("&#8465", "ℑ")
            .put("&weierp", "℘")
            .put("&#8472", "℘")
            .put("&real", "ℜ")
            .put("&#8476", "ℜ")
            .put("&trade", "™")
            .put("&#8482", "™")
            .put("&alefsym", "ℵ")
            .put("&#8501", "ℵ")
            .put("&larr", "←")
            .put("&#8592", "←")
            .put("&uarr", "↑")
            .put("&#8593", "↑")
            .put("&rarr", "→")
            .put("&#8594", "→")
            .put("&darr", "↓")
            .put("&#8595", "↓")
            .put("&harr", "↔")
            .put("&#8596", "↔")
            .put("&crarr", "↵")
            .put("&#8629", "↵")
            .put("&lArr", "⇐")
            .put("&#8656", "⇐")
            .put("&uArr", "⇑")
            .put("&#8657", "⇑")
            .put("&rArr", "⇒")
            .put("&#8658", "⇒")
            .put("&dArr", "⇓")
            .put("&hArr", "⇔")
            .put("&#8660", "⇔")
            .put("&forall", "∀")
            .put("&#8704", "∀")
            .put("&part", "∂")
            .put("&#8706", "∂")
            .put("&exist", "∃")
            .put("&#8707", "∃")
            .put("&empty", "∅")
            .put("&#8709", "∅")
            .put("&nabla", "∇")
            .put("&#8711", "∇")
            .put("&isin", "∈")
            .put("&#8712", "∈")
            .put("&notin", "∉")
            .put("&#8713", "∉")
            .put("&ni", "∋")
            .put("&#8715", "∋")
            .put("&prod", "∏")
            .put("&#8719", "∏")
            .put("&sum", "∑")
            .put("&#8721", "∑")
            .put("&minus", "−")
            .put("&#8722", "−")
            .put("&lowast", "∗")
            .put("&#8727", "∗")
            .put("&radic", "√")
            .put("&#8730", "√")
            .put("&prop", "∝")
            .put("&#8733", "∝")
            .put("&infin", "∞")
            .put("&#8734", "∞")
            .put("&ang", "∠")
            .put("&#8736", "∠")
            .put("&and", "∧")
            .put("&#8743", "∧")
            .put("&or", "∨")
            .put("&#8744", "∨")
            .put("&cap", "∩")
            .put("&#8745", "∩")
            .put("&cup", "∪")
            .put("&#8746", "∪")
            .put("&int", "∫")
            .put("&#8747", "∫")
            .put("&there4", "∴")
            .put("&#8756", "∴")
            .put("&sim", "∼")
            .put("&#8764", "∼")
            .put("&cong", "≅")
            .put("&#8773", "≅")
            .put("&asymp", "≈")
            .put("&#8776", "≈")
            .put("&ne", "≠")
            .put("&#8800", "≠")
            .put("&equiv", "≡")
            .put("&#8801", "≡")
            .put("&le", "≤")
            .put("&#8804", "≤")
            .put("&ge", "≥")
            .put("&#8805", "≥")
            .put("&sub", "⊂")
            .put("&#8834", "⊂")
            .put("&sup", "⊃")
            .put("&#8835", "⊃")
            .put("&nsub", "⊄")
            .put("&#8836", "⊄")
            .put("&sube", "⊆")
            .put("&#8838", "⊆")
            .put("&supe", "⊇")
            .put("&#8839", "⊇")
            .put("&oplus", "⊕")
            .put("&#8853", "⊕")
            .put("&otimes", "⊗")
            .put("&#8855", "⊗")
            .put("&perp", "⊥")
            .put("&#8869", "⊥")
            .put("&sdot", "⋅")
            .put("&#8901", "⋅")
            .put("&lceil", "⌈")
            .put("&#8968", "⌈")
            .put("&rceil", "⌉")
            .put("&#8969", "⌉")
            .put("&lfloor", "⌊")
            .put("&#8970", "⌊")
            .put("&rfloor", "⌋")
            .put("&#8971", "⌋")
            .put("&lang", "〈")
            .put("&#9001", "〈")
            .put("&rang", "〉")
            .put("&#9002", "〉")
            .put("&loz", "◊")
            .put("&#9674", "◊")
            .put("&spades", "♠")
            .put("&#9824", "♠")
            .put("&clubs", "♣")
            .put("&#9827", "♣")
            .put("&hearts", "♥")
            .put("&#9829", "♥")
            .put("&diams", "♦")
            .put("&#9830", "♦")
            .build();

    public static final String unescape(final String input) {
        int amp, semi;
        String result = input;

        boolean done = false;
        int start = 0;
        do {
            amp = result.indexOf("&", start);
            if (amp == -1) {
                done = true;
            }
            else {
                semi = result.indexOf(";", amp);
                if (semi > -1) {
                    String charRef = result.substring(amp, semi);
                    String value = map.get(charRef);
                    if (value != null) {
                        result = result.substring(0, amp) + value + result.substring(semi + 1);
                    }
                    start = amp + 1;
                }
            }
        }
        while (!done);

        return result;
    }

}
